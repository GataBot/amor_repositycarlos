<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Una Sorpresa Para Ti</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* ---- Estilos Generales ---- */
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden;
            background: linear-gradient(315deg, #f3e7e9, #e3eeff, #fdfaff);
            background-size: 400% 400%;
            animation: gradient-animation 15s ease infinite;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            perspective: 1000px;
        }
        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .dancing-script { font-family: 'Dancing Script', cursive; }

        /* ---- Preloader ---- */
        #preloader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #fdfaff; display: flex; justify-content: center;
            align-items: center; z-index: 10000; flex-direction: column;
            gap: 1rem; transition: opacity 0.5s ease;
        }
        .heart-loader {
            width: 50px; height: 50px; background: #d8bfd8;
            position: relative; transform: rotate(45deg); animation: beat 1s infinite;
        }
        .heart-loader:before, .heart-loader:after {
            content: ""; position: absolute; width: 50px; height: 50px;
            border-radius: 50%; background: #d8bfd8;
        }
        .heart-loader:before { top: -25px; left: 0; }
        .heart-loader:after { top: 0; left: -25px; }
        @keyframes beat {
            0%, 100% { transform: rotate(45deg) scale(1); }
            50% { transform: rotate(45deg) scale(1.1); }
        }

        /* ---- Sobre ---- */
        .envelope-wrapper {
            transition: transform 1s ease-in-out, opacity 0.5s 2s ease;
            opacity: 0;
        }
        .envelope-wrapper.loaded { opacity: 1; }
        .envelope {
            position: relative;
            width: 340px; 
            height: 220px;
            border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            transition: all 1s ease-in-out; transform-style: preserve-3d;
            background-color: #e9d8e9;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23d8bfd8' fill-opacity='0.2'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        .envelope-back { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 12px; z-index: 1; }
        .flap {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #c3aed6; 
            clip-path: polygon(0 0, 100% 0, 50% 55%);
            transform-origin: top; transition: transform 1s ease-in-out; z-index: 3; transform: rotateX(0deg);
        }
        .wax-seal {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 50px; height: 50px;
            background-color: #b19cd9;
            border-radius: 50%;
            z-index: 4;
            cursor: pointer;
            display: flex; justify-content: center; align-items: center;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3), inset -2px -2px 4px rgba(0,0,0,0.2);
            animation: pulse-seal 2s infinite;
        }
        .wax-seal svg { width: 60%; height: 60%; fill: #9370db; }
        @keyframes pulse-seal {
            0% { box-shadow: 2px 2px 5px rgba(0,0,0,0.3), 0 0 0 0 rgba(177, 156, 217, 0.7); }
            70% { box-shadow: 2px 2px 5px rgba(0,0,0,0.3), 0 0 0 10px rgba(177, 156, 217, 0); }
            100% { box-shadow: 2px 2px 5px rgba(0,0,0,0.3), 0 0 0 0 rgba(177, 156, 217, 0); }
        }
        .open .flap { transform: rotateX(180deg); transition-delay: 0.2s; }
        .open .envelope-wrapper { transform: translateY(110vh) rotateZ(15deg) scale(0.5); opacity: 0; }
        .open .wax-seal { opacity: 0; transition: opacity 0.2s; }
        
        /* ---- Página de la Carta ---- */
        .full-page-letter {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #fdfaff;
            z-index: 100; display: flex; justify-content: center; align-items: flex-start;
            transform: scale(0); opacity: 0;
            transition: transform 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55), opacity 0.5s ease;
            transition-delay: 1.8s;
            padding: 5vh 2vw;
        }
        .open .full-page-letter { transform: scale(1); opacity: 1; }
        .paper-sheet {
            background: #ffffff; width: 90%; max-width: 800px; max-height: 90vh;
            border-radius: 10px; padding: 40px 50px; overflow-y: auto; text-align: center;
            position: relative; animation: neon-glow 2.5s infinite alternate;
        }
        @keyframes neon-glow {
            from { box-shadow: 0 0 10px #d8bfd8, 0 0 20px #d8bfd8, 0 0 30px #c3aed6, 0 0 40px #8a2be2; }
            to { box-shadow: 0 0 5px #d8bfd8, 0 0 10px #d8bfd8, 0 0 15px #c3aed6, 0 0 20px #8a2be2; }
        }
        
        /* ---- NUEVA MEJORA: Animación de revelado de texto ---- */
        #love-letter-text p {
            opacity: 0; /* Párrafos invisibles al inicio */
        }
        .reveal-text {
            opacity: 0;
            transform: translateY(20px);
            animation: reveal 1s ease-out forwards;
        }
        @keyframes reveal {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ---- Botones Sí/No ---- */
        .declaration { margin-top: 40px; padding-top: 20px; border-top: 1px dashed #d8bfd8; }
        .buttons { margin-top: 20px; display: flex; justify-content: center; gap: 20px; position: relative; height: 50px; }
        .btn { padding: 10px 25px; border-radius: 8px; font-weight: bold; color: white; cursor: pointer; transition: all 0.3s ease; border: none; }
        .btn-yes { background-color: #8a2be2; }
        .btn-yes:hover { background-color: #9932cc; transform: scale(1.05); }
        .btn-no { 
            background-color: #c3aed6; 
            position: absolute;
            /* ---- NUEVA MEJORA: Transición para el botón "No" ---- */
            transition: all 0.3s ease, transform 0.2s ease-out, opacity 0.2s ease-out;
        }
        .btn-no.evading {
            transform: scale(0.8);
            opacity: 0.7;
        }
        
        /* ---- Carrusel de Fotos ---- */
        #photoCarousel { opacity: 0; transition: opacity 1s ease 1s; margin: 40px auto 0 auto; width: 180%; max-width: 500px; }
        .carousel-wrapper { position: relative; }
        /* ---- NUEVA MEJORA: Animación de borde para el carrusel ---- */
        .carousel-container { 
            border-radius: 15px; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.2); border: 3px solid #d8bfd8;
            animation: glow-border 4s infinite alternate;
        }
        @keyframes glow-border {
            from { border-color: #d8bfd8; box-shadow: 0 10px 25px rgba(0,0,0,0.2), 0 0 15px #d8bfd8; }
            to { border-color: #8a2be2; box-shadow: 0 10px 25px rgba(0,0,0,0.2), 0 0 15px #8a2be2; }
        }
        .carousel-slide { display: none; animation: fade 0.7s ease-in-out; }
        @keyframes fade { from {opacity: .4} to {opacity: 1} }
        .carousel-slide img { width: 100%; height: auto; display: block; }
        .carousel-prev, .carousel-next {
            cursor: pointer; position: absolute; top: 50%; transform: translateY(-50%);
            width: 44px; height: 44px; display: flex; align-items: center; justify-content: center;
            color: white; transition: 0.4s ease; border-radius: 50%; background-color: rgba(138, 43, 226, 0.4); z-index: 10;
        }
        .carousel-prev { left: 1rem; }
        .carousel-next { right: 1rem; }
        .carousel-prev:hover, .carousel-next:hover { background-color: rgba(138, 43, 226, 0.8); }
        .carousel-dots { text-align: center; padding-top: 15px; }
        .dot {
            cursor: pointer; height: 13px; width: 13px; margin: 0 5px; background-color: #c3aed6;
            border-radius: 50%; display: inline-block; transition: background-color 0.6s ease;
        }
        .active-dot, .dot:hover { background-color: #8a2be2; }
        
        /* ---- Animaciones y Efectos Adicionales ---- */
        /* Partículas, Flores, Confeti, Corazones (sin cambios) */
        #click-particles { position: fixed; inset: 0; pointer-events: none; z-index: 9998; }
        .click-particle { position: absolute; background-color: var(--color); border-radius: 50%; animation: pop-particle 0.6s ease-out forwards; }
        @keyframes pop-particle { from { transform: translate(0, 0) scale(1); opacity: 1; } to { transform: translate(var(--x), var(--y)) scale(0); opacity: 0; } }
        #bouquet { position: fixed; left: 50%; bottom: 0; width: 300px; height: 400px; transform: translateX(-50%) translateY(100%); opacity: 0; transition: transform 1.2s cubic-bezier(0.68, -0.55, 0.27, 1.55), opacity 0.8s ease; z-index: 200; pointer-events: none; }
        #bouquet.show { opacity: 1; transform: translateX(-50%) translateY(0); }
        #bouquet.hide { opacity: 0; transform: translateX(-50%) translateY(100%); transition: all 1s ease-in 0.5s; }
        .flower-wrap { position: absolute; bottom: 0; left: 50%; }
        #flower1 { transform: translateX(-50%) rotate(-20deg) scale(0.9); }
        #flower2 { transform: translateX(-50%) rotate(5deg) scale(1); z-index: 10; bottom: 10px; }
        #flower3 { transform: translateX(-50%) rotate(25deg) scale(0.85); }
        .stem { width: 8px; height: 250px; background: linear-gradient(to top, #38761d, #6aa84f); border-radius: 4px; transform-origin: bottom; transform: scaleY(0); }
        .flower-head { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 80px; height: 80px; }
        .petal { position: absolute; left: 50%; top: 50%; transform-origin: bottom center; transform: translate(-50%, -50%) rotate(var(--r, 0deg)) translateY(-20px) scale(0); width: 40px; height: 50px; background: radial-gradient(circle at 50% 100%, #e0b0ff, #a46ed6); border-radius: 50% 50% 0 0; opacity: 0; }
        #bouquet.show .stem { animation: grow-stem 1s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards; }
        @keyframes grow-stem { from { transform: scaleY(0); } to { transform: scaleY(1); } }
        #bouquet.show .petal { animation: bloom-petal 1.2s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; animation-delay: calc(0.8s + var(--d)); }
        @keyframes bloom-petal { 0% { transform: translate(-50%, -50%) rotate(var(--r, 0deg)) translateY(-20px) scale(0); opacity: 0; } 100% { transform: translate(-50%, -50%) rotate(var(--r, 0deg)) translateY(-20px) scale(1); opacity: 1; } }
        .flower-center { position: absolute; top: 50%; left: 50%; width: 20px; height: 20px; background: radial-gradient(circle, #ffee58, #f5d400); border-radius: 50%; transform: translate(-50%, -50%) scale(0); opacity: 0; }
        #bouquet.show .flower-center { animation: bloom-center 0.6s ease forwards 1.5s; }
        @keyframes bloom-center { from { transform: translate(-50%, -50%) scale(0); opacity: 0; } to { transform: translate(-50%, -50%) scale(1); opacity: 1; } }
        #finalMessage, #concludingMessage { opacity: 0; transition: opacity 1.5s ease; }
        #concludingMessage { transition-delay: 1s; }
        #confetti-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; }
        .confetti-piece { position: absolute; width: 10px; height: 20px; opacity: 0; animation: fall 5s linear forwards; }
        @keyframes fall { 0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; } 100% { transform: translateY(110vh) rotate(720deg); opacity: 0; } }
        #hearts-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; overflow: hidden; }
        .heart { position: absolute; width: 20px; height: 20px; opacity: 0; animation: float-heart 8s linear forwards; }
        .heart::before, .heart::after { content: ''; position: absolute; width: 20px; height: 20px; background: #e0b0ff; border-radius: 50%; }
        .heart::before { top: -10px; left: 0; }
        .heart::after { top: 0; left: -10px; }
        @keyframes float-heart { 0% { transform: translateY(100%) rotate(45deg); opacity: 1; } 100% { transform: translateY(-100px) rotate(45deg); opacity: 0; } }
        #mute-btn { position: fixed; bottom: 20px; right: 20px; background-color: rgba(0,0,0,0.2); border: none; border-radius: 50%; width: 50px; height: 50px; display: flex; justify-content: center; align-items: center; cursor: pointer; z-index: 1001; opacity: 0; transition: opacity 0.5s ease; }
        #mute-btn.visible { opacity: 1; }
    </style>
</head>
<body>
    <div id="preloader">
        <div class="heart-loader"></div>
        <p class="text-purple-500 dancing-script text-2xl mt-8">Cargando sorpresa...</p>
    </div>

    <audio id="background-music" loop>
        <source src="musica.mp3" type="audio/mpeg">
    </audio>
    <div id="confetti-container"></div>
    <div id="click-particles"></div>
    
    <div id="envelopeWrapper" class="envelope-wrapper">
        <div class="envelope">
            <div class="flap">
                <div class="wax-seal">
                    <svg viewBox="0 0 24 24"><path d="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5C2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.03L12,21.35Z"></path></svg>
                </div>
            </div>
            <div class="envelope-back"></div>
        </div>
        <p class="text-center mt-4 text-gray-600 font-semibold text-2xl dancing-script">Una sorpresa para ti...</p>
    </div>

    <div id="fullPageLetter" class="full-page-letter">
        <div class="paper-sheet">
            <div id="hearts-container"></div>
            <h1 class="dancing-script text-5xl md:text-6xl text-purple-600 mb-4">
                ¡Feliz 1 año y 4 meses, Mi Amor!
            </h1>
            <div id="love-letter-text" class="text-left text-gray-700 text-lg leading-relaxed">
                <p class="mb-4">Hoy, 23 de Junio, es un día muy especial para mí y para ti porque cumplimos 16 meses juntos, mi amor bella, No puedo creer que ya hayan pasado 16 meses desde que te pedí ser mi novia en esa cita tan especial que tuvimos en sendero, después de haber ido a comer pollito KFC, Recuerdo ese momento como si hubiera sido ayer mi vida Como cuando te vi por primera vez tu te veías tan bonita y yo tan feliz de verte.</p>
                <p class="mb-4">Amorcitoooo corazón y lo vuelvo a decir hoy pero hoy este día cumplimos 16 meses, y si no lo sabes lo feliz que estoy y me siento, porque estoy con una persona tan maravillosa y única como tu mi niña, Sabes mi amor me alegra haberte conocido, fuiste mi mejor casualidad, soy tan afortunado de tenerte en mi vida, no es mentira, es en serio, me encanta que estés en mi vida, has sido mi compañera en este viaje llamado vida, y juntos hemos superado obstáculos y diferencias hemos tenido problemas, Pero a pesar de todo, aquí estamos, más fuertes que nunca a pesar de nuestras peleas y indiferencia, Me gustas tal y Como la primera vez , te amoooo muchísimo, amo todo de ti tus ojos, tus labios, tu cabello, tu aroma, tus abrazos, tus besos, tu risa y tu alegría todo de ti amo aunque pienses que no me encantas mucho y demasiado mi vida Simplemente amo todo de ti, para mí eres perfecta mi corazoncito te adoro bastante sabes me siento feliz y orgulloso de estar contigo de ver cada uno de tus virtudes y ver lo capaz que eres de hacer las cosas lo que logras y te esfuerzas valoro mucho cada momento a tu lado y lo que haces me siento afortunado contigo.</p>
                <p class="mb-4">Y sabes que me gusta más de esto, es que sigo estando tan enamorado de ti como la primera vez que te vi tal y Como te lo dije, Mi amor por ti no ha disminuido, sino que ha crecido cada día más. Te amo hoy y siempre, mi amor.
Hoy día en este pasémoslo espectacular amándonos como siempre y sigamos cumpliendo más meses, años y los que tengan por venir, No te pienso soltar, tampoco lo hagas tú, Eres la razón por la que me levanto cada mañana, eres mi motivación, mi inspiración eres lo que eres un ser hecho para estar conmigo y yo contigo.</p>
                <p class="mb-4">Te amo, te amo, te amo No tengo palabras para expresar lo mucho que te amo. Eres mi todo Te amo más que ayer y nunca menos que mañana.</p>
                <p class="mb-4 font-bold">FELIZ 16 MESVERSARIO MI AMOR, TE AMOOOOOOO. Siempre te amaré.</p>
            </div>
            
            <div id="declarationSection" class="declaration">
                <p class="text-2xl md:text-3xl font-semibold text-purple-700 mb-4">
                    ¿Quieres seguir estando conmigo más tiempo, mi vida?
                </p>
                <div class="buttons">
                    <button id="yesBtn" class="btn btn-yes z-10">Sí, mil veces sí</button>
                    <button id="noBtn" class="btn btn-no">No</button>
                </div>
            </div>

            <div id="finalContent" class="hidden">
                 <h2 id="finalMessage" class="dancing-script text-4xl text-purple-600 mt-8">¡Para siempre y un día más! Te amo.</h2>
                 <div id="photoCarousel" class="mx-auto">
                    <h3 class="text-2xl text-purple-600 mb-4 mt-8 dancing-script">Nuestros Momentos</h3>
                    <div class="carousel-wrapper">
                        <div class="carousel-container">
                            <!-- =================================================================== -->
                            <!-- ============== CAMBIO: Ahora son 4 imágenes =============== -->
                            <!-- =================================================================== -->
                            <div class="carousel-slide"><img src="img1.jpg" alt="Recuerdo 1"></div>
                            <div class="carousel-slide"><img src="img2.JPG" alt="Recuerdo 2"></div>
                            <div class="carousel-slide"><img src="img3.JPG" alt="Recuerdo 3"></div>
                            <div class="carousel-slide"><img src="img4.JPG" alt="Recuerdo 4"></div>
                        </div>
                        <a class="carousel-prev" onclick="plusSlides(-1)">
                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                        </a>
                        <a class="carousel-next" onclick="plusSlides(1)">
                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </a>
                    </div>
                    <div class="carousel-dots">
                        <!-- ============== CAMBIO: Ahora son 4 puntos =============== -->
                        <span class="dot" onclick="currentSlide(1)"></span> 
                        <span class="dot" onclick="currentSlide(2)"></span> 
                        <span class="dot" onclick="currentSlide(3)"></span> 
                        <span class="dot" onclick="currentSlide(4)"></span> 
                    </div>
                 </div>
                 <h2 id="concludingMessage" class="dancing-script text-3xl text-purple-500 mt-10">Gracias por cada momento.</h2>
            </div>
        </div>
    </div>
    
    <button id="mute-btn">
        <!-- Icons will be injected by JS -->
    </button>
    
    <div id="bouquet">
        <div class="flower-wrap" id="flower1"><div class="stem"></div><div class="flower-head"><div class="petal" style="--r: -30deg; --d: 0.1s;"></div><div class="petal" style="--r: 0deg; --d: 0s;"></div><div class="petal" style="--r: 30deg; --d: 0.1s;"></div><div class="petal" style="--r: 60deg; --d: 0.2s;"></div><div class="petal" style="--r: -60deg; --d: 0.2s;"></div><div class="flower-center"></div></div></div>
        <div class="flower-wrap" id="flower2"><div class="stem"></div><div class="flower-head"><div class="petal" style="--r: -30deg; --d: 0.3s;"></div><div class="petal" style="--r: 0deg; --d: 0.2s;"></div><div class="petal" style="--r: 30deg; --d: 0.3s;"></div><div class="petal" style="--r: 60deg; --d: 0.4s;"></div><div class="petal" style="--r: -60deg; --d: 0.4s;"></div><div class="flower-center"></div></div></div>
        <div class="flower-wrap" id="flower3"><div class="stem"></div><div class="flower-head"><div class="petal" style="--r: -30deg; --d: 0.2s;"></div><div class="petal" style="--r: 0deg; --d: 0.1s;"></div><div class="petal" style="--r: 30deg; --d: 0.2s;"></div><div class="petal" style="--r: 60deg; --d: 0.3s;"></div><div class="petal" style="--r: -60deg; --d: 0.3s;"></div><div class="flower-center"></div></div></div>
    </div>

    <script>
        // DOM Elements
        const body = document.body;
        const yesBtn = document.getElementById('yesBtn');
        const noBtn = document.getElementById('noBtn');
        const declarationSection = document.getElementById('declarationSection');
        const finalContent = document.getElementById('finalContent');
        const bouquet = document.getElementById('bouquet');
        const finalMessage = document.getElementById('finalMessage');
        const concludingMessage = document.getElementById('concludingMessage');
        const photoCarousel = document.getElementById('photoCarousel');
        const music = document.getElementById('background-music');
        const preloader = document.getElementById('preloader');
        const muteBtn = document.getElementById('mute-btn');
        const waxSeal = document.querySelector('.wax-seal');

        // Speaker Icons
        const speakerOnIcon = `<svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path></svg>`;
        const speakerOffIcon = `<svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" clip-rule="evenodd"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l-4-4m0 4l4-4"></path></svg>`;

        window.addEventListener('load', () => {
            if(preloader) {
                preloader.style.opacity = '0';
                setTimeout(() => {
                    preloader.style.display = 'none';
                    document.getElementById('envelopeWrapper').classList.add('loaded');
                }, 500);
            }
        });
        
        try {
            const urlParams = new URLSearchParams(window.location.search);
            const songUrl = urlParams.get('song');
            if (songUrl) {
                music.querySelector('source').src = decodeURIComponent(songUrl);
                music.load();
            }
        } catch(e) { console.error("Error processing song URL:", e); }

        muteBtn.innerHTML = speakerOnIcon;
        muteBtn.addEventListener('click', () => {
            music.muted = !music.muted;
            muteBtn.innerHTML = music.muted ? speakerOffIcon : speakerOnIcon;
        });
        
        // ---- NUEVA MEJORA: Función para revelar el texto de la carta ----
        function revealLetterText() {
            const paragraphs = document.querySelectorAll('#love-letter-text p');
            paragraphs.forEach((p, index) => {
                p.style.animationDelay = `${index * 1.2}s`; // Stagger the animation
                p.classList.add('reveal-text');
            });
        }

        waxSeal.addEventListener('click', (e) => {
            createClickParticles(e.clientX, e.clientY);
            body.classList.add('open');
            waxSeal.style.pointerEvents = 'none';
            muteBtn.classList.add('visible');
            music.play().catch(error => console.log("Autoplay was blocked."));
            setInterval(createHeart, 500);
            
            // Iniciar la animación de texto después de que la carta aparezca
            setTimeout(revealLetterText, 2500);
        });

        yesBtn.addEventListener('click', () => {
            celebrate();
            declarationSection.style.display = 'none';
            finalContent.classList.remove('hidden');
            bouquet.classList.add('show');
            finalMessage.style.opacity = '1';
            photoCarousel.style.opacity = '1';
            setTimeout(() => {
                bouquet.classList.remove('show');
                bouquet.classList.add('hide');
            }, 5000);
            setTimeout(() => {
                concludingMessage.style.opacity = '1';
            }, 5500);
        });
        
        // ---- NUEVA MEJORA: Lógica del botón "No" actualizada ----
        noBtn.addEventListener('mouseover', moveButton);
        noBtn.addEventListener('click', moveButton);
        function moveButton() {
            const container = document.querySelector('.buttons');
            const containerRect = container.getBoundingClientRect();
            const btnRect = noBtn.getBoundingClientRect();
            let newTop = Math.random() * (containerRect.height - btnRect.height);
            let newLeft = Math.random() * (containerRect.width - btnRect.width);
            noBtn.style.top = `${newTop}px`;
            noBtn.style.left = `${newLeft}px`;
            
            // Añade clase para efecto de "escape"
            noBtn.classList.add('evading');
            setTimeout(() => {
                noBtn.classList.remove('evading');
            }, 200);
        }

        function celebrate() {
            const confettiContainer = document.getElementById('confetti-container');
            const colors = ['#d8bfd8', '#c3aed6', '#8a2be2', '#ffd700', '#f0e68c'];
            for (let i = 0; i < 100; i++) {
                const confettiPiece = document.createElement('div');
                confettiPiece.classList.add('confetti-piece');
                confettiPiece.style.left = `${Math.random() * 100}vw`;
                confettiPiece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confettiPiece.style.transform = `rotate(${Math.random() * 360}deg)`;
                confettiPiece.style.animationDelay = `${Math.random() * 0.5}s`;
                confettiContainer.appendChild(confettiPiece);
                
                setTimeout(() => {
                    confettiPiece.remove();
                }, 5000);
            }
        }

        function createClickParticles(x, y) {
            const container = document.getElementById('click-particles');
            const colors = ['#e0b0ff', '#c3aed6', '#fdfaff'];
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.classList.add('click-particle');
                const size = Math.floor(Math.random() * 5 + 2);
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.top = `${y}px`;
                particle.style.left = `${x}px`;
                const angle = Math.random() * Math.PI * 2;
                const distance = Math.random() * 50 + 20;
                particle.style.setProperty('--x', `${Math.cos(angle) * distance}px`);
                particle.style.setProperty('--y', `${Math.sin(angle) * distance}px`);
                particle.style.setProperty('--color', colors[Math.floor(Math.random() * colors.length)]);
                container.appendChild(particle);
                setTimeout(() => particle.remove(), 600);
            }
        }
        
        function createHeart() {
            const heartsContainer = document.getElementById('hearts-container');
            if (!heartsContainer) return;
            const heart = document.createElement('div');
            heart.classList.add('heart');
            heart.style.left = `${Math.random() * 100}%`;
            heart.style.animationDuration = `${Math.random() * 3 + 5}s`;
            heartsContainer.appendChild(heart);
            setTimeout(() => {
                heart.remove();
            }, 8000);
        }

        let slideIndex = 1;
        showSlides(slideIndex);
        function plusSlides(n) { showSlides(slideIndex += n); }
        function currentSlide(n) { showSlides(slideIndex = n); }
        function showSlides(n) {
            let i;
            let slides = document.getElementsByClassName("carousel-slide");
            let dots = document.getElementsByClassName("dot");
            if (!slides.length) return;
            if (n > slides.length) {slideIndex = 1}    
            if (n < 1) {slideIndex = slides.length}
            for (i = 0; i < slides.length; i++) {
                slides[i].style.display = "none";  
            }
            for (i = 0; i < dots.length; i++) {
                dots[i].className = dots[i].className.replace(" active-dot", "");
            }
            slides[slideIndex-1].style.display = "block";  
            dots[slideIndex-1].className += " active-dot";
        }
    </script>
</body>
</html>